// tests/todo.test.js
// Юніт-тести для Mini ToDo Manager
// Використовуємо Jest + jsdom

describe('Mini ToDo Manager — Unit тести', () => {

  // Завантажуємо HTML перед кожним тестом
  beforeEach(() => {
    document.documentElement.innerHTML = `
      <!DOCTYPE html>
      <html lang="uk">
      <body>
        <ul class="task-list" id="taskList"></ul>
        <div class="modal" id="addModal">
          <div class="modal-content">
            <input type="text" id="newTaskInput" value="" />
            <select id="taskCategory"><option value="Сьогодні">Сьогодні</option></select>
            <select id="taskDate"><option value="Сьогодні">Сьогодні</option></select>
            <select id="taskPriority"><option value="Високий">Високий</option></select>
            <button id="saveTask">Додати</button>
          </div>
        </div>
        <button id="openModal">+</button>
      </body>
      </html>
    `;

    // Вставляємо скрипт з твого додатку (скорочена версія для тестів)
    window.initialTasks = [];
    window.taskList = document.getElementById('taskList');

    window.renderTasks = function() {
      taskList.innerHTML = '';
      window.initialTasks.forEach(task => {
        const li = document.createElement('li');
        li.className = `task-item ${task.done ? 'done' : ''}`;
        li.innerHTML = `
          <div class="checkbox ${task.done ? 'checked' : ''}"></div>
          <div class="task-text">
            ${task.text}
            <div class="category">${task.category} • ${task.priority}</div>
          </div>
        `;
        li.querySelector('.checkbox').addEventListener('click', () => {
          task.done = !task.done;
          window.renderTasks();
        });
        taskList.appendChild(li);
      });
    };

    // Імітуємо логіку додавання завдання
    document.getElementById('saveTask').addEventListener('click', () => {
      const text = document.getElementById('newTaskInput').value.trim();
      if (text) {
        window.initialTasks.unshift({
          text,
          category: document.getElementById('taskCategory').value,
          date: document.getElementById('taskDate').value,
          priority: document.getElementById('taskPriority').value,
          done: false
        });
        window.renderTasks();
        document.getElementById('newTaskInput').value = '';
      }
    });

    window.renderTasks(); // початковий рендер
  });

  // ТЕСТ 1: Додавання нового завдання
  test('повинно додавати нове завдання в список', () => {
    // Підготовка
    document.getElementById('newTaskInput').value = 'Вивчити JavaScript';
    
    // Дія
    document.getElementById('saveTask').click();

    // Перевірка
    expect(window.initialTasks.length).toBe(1);
    expect(window.initialTasks[0].text).toBe('Вивчити JavaScript');
    expect(window.initialTasks[0].category).toBe('Сьогодні');
    expect(window.initialTasks[0].priority).toBe('Високий');
    expect(taskList.children.length).toBe(1);
    expect(taskList.children[0].querySelector('.task-text').textContent)
      .toContain('Вивчити JavaScript');
  });

  // ТЕСТ 2: Позначення завдання як виконане
  test('повинно правильно перемикати статус виконання завдання', () => {
    // Додаємо завдання
    document.getElementById('newTaskInput').value = 'Прочитати книгу';
    document.getElementById('saveTask').click();

    const checkbox = taskList.children[0].querySelector('.checkbox');

    // Спочатку — не виконано
    expect(window.initialTasks[0].done).toBe(false);
    expect(checkbox.classList.contains('checked')).toBe(false);

    // Клікаємо — виконано
    checkbox.click();
    expect(window.initialTasks[0].done).toBe(true);
    expect(checkbox.classList.contains('checked')).toBe(true);
    expect(taskList.children[0].classList.contains('done')).toBe(true);

    // Клікаємо ще раз — знімаємо виконання
    checkbox.click();
    expect(window.initialTasks[0].done).toBe(false);
    expect(checkbox.classList.contains('checked')).toBe(false);
  });
});
